<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
  <title>The Book of Ξ</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #00ff9d;
      --secondary-color: #ff00ff;
      --bg-color: #111;
      --text-color: #eee;
      --card-bg: rgba(0, 0, 0, 0.5);
      --border-color: #333;
      --hover-bg: #222;
    }
    
    * {
      box-sizing: border-box;
      transition: all 0.3s ease;
    }
    
    body {
      font-family: 'JetBrains Mono', 'Space Mono', monospace;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      line-height: 1.6;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(0, 255, 157, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(255, 0, 255, 0.05) 0%, transparent 50%);
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
      transition: margin-left 0.3s ease;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: var(--primary-color);
      text-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
      letter-spacing: -1px;
    }
    
    h2, h3 {
      color: var(--primary-color);
      letter-spacing: -0.5px;
    }
    
    .sidebar {
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100%;
      background-color: #222;
      border-right: 1px solid var(--border-color);
      transition: left 0.3s ease;
      z-index: 1000;
      padding-top: 60px;
      overflow-y: auto;
      box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
    }
    
    .sidebar.active {
      left: 0;
    }
    
    .sidebar-item {
      padding: 10px 20px;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }
    
    .sidebar-item:hover {
      background-color: var(--hover-bg);
      color: var(--primary-color);
      border-left: 3px solid var(--primary-color);
      padding-left: 25px;
    }
    
    .sidebar-chapter {
      padding: 12px 20px;
      color: var(--primary-color);
      font-weight: bold;
      border-bottom: 1px solid var(--border-color);
      margin-top: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 0.8em;
    }
    
    .sidebar-subitem {
      padding: 8px 20px 8px 40px;
      color: #ccc;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }
    
    .sidebar-subitem:hover {
      background-color: var(--hover-bg);
      color: var(--primary-color);
      border-left: 3px solid var(--primary-color);
      padding-left: 45px;
    }
    
    .toggle-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 24px;
      color: var(--primary-color);
      background: none;
      border: none;
      cursor: pointer;
      z-index: 1001;
      transition: all 0.3s;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .toggle-btn:hover {
      text-shadow: 0 0 10px var(--primary-color);
      background-color: rgba(0, 0, 0, 0.8);
      transform: rotate(90deg);
    }
    
    .content {
      margin-top: 2rem;
    }
    
    .card {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
      background-color: var(--card-bg);
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(0, 255, 157, 0.05), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 25px rgba(0, 255, 157, 0.2);
      border-color: var(--primary-color);
    }
    
    .card:hover::before {
      transform: translateX(100%);
    }
    
    .card h2 {
      color: var(--primary-color);
      margin-top: 0;
    }
    
    select {
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      background-color: #222;
      color: var(--text-color);
      margin-bottom: 1rem;
      font-family: 'JetBrains Mono', monospace;
      cursor: pointer;
    }
    
    select:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 5px var(--primary-color);
    }
    
    .quantum-test {
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      color: var(--primary-color);
      border: 1px solid var(--secondary-color);
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .quantum-test::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 0, 255, 0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }
    
    .quantum-test:hover::after {
      opacity: 1;
    }

    .question {
      margin-bottom: 20px;
    }

    .test-button {
      background: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
      padding: 8px 20px;
      margin: 5px 10px 20px 0;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
      position: relative;
      overflow: hidden;
    }

    .test-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 255, 157, 0.2);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: -1;
    }

    .test-button:hover {
      background: rgba(0, 255, 157, 0.1);
      box-shadow: 0 0 15px rgba(0, 255, 157, 0.3);
      transform: translateY(-2px);
    }
    
    .test-button:hover::before {
      transform: translateX(0);
    }

    .test-button:active {
      transform: translateY(1px);
    }

    #test-result {
      padding: 20px;
      color: var(--primary-color);
      border-top: 1px dashed rgba(0, 255, 157, 0.3);
      margin-top: 20px;
    }

    .hidden {
      display: none;
    }

    .loading {
      animation: blink 1s infinite;
    }
    
    .loading::after {
      content: '...';
      animation: dots 1.5s infinite;
    }

    .success, .failure {
      margin-top: 10px;
      padding: 15px;
      border-radius: 5px;
      transition: all 0.5s ease;
    }
    
    .success {
      background: rgba(0, 255, 157, 0.1);
      border-left: 3px solid var(--primary-color);
    }
    
    .failure {
      background: rgba(255, 0, 0, 0.1);
      border-left: 3px solid #ff0000;
    }

    .result {
      font-weight: bold;
    }

    .continue-link {
      color: var(--primary-color);
      text-decoration: none;
      border: 1px solid var(--primary-color);
      padding: 10px 20px;
      display: none;
      transition: all 0.3s;
      border-radius: 4px;
      margin-top: 15px;
      display: inline-block;
      font-weight: bold;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .continue-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--primary-color);
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.3s ease;
      z-index: -1;
    }

    .continue-link:hover {
      color: #000;
      box-shadow: 0 0 15px rgba(0, 255, 157, 0.5);
    }
    
    .continue-link:hover::before {
      transform: scaleX(1);
      transform-origin: left;
    }

    .failure-message {
      color: #ff0000;
      font-weight: bold;
      text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
    }

    .reset-button {
      background: transparent;
      color: #ff0000;
      border: 1px solid #ff0000;
      padding: 8px 20px;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 4px;
      margin-top: 10px;
      font-family: 'JetBrains Mono', monospace;
    }

    .reset-button:hover {
      background: rgba(255, 0, 0, 0.1);
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
    }

    @keyframes blink {
      0% { opacity: 0.2; }
      50% { opacity: 1; }
      100% { opacity: 0.2; }
    }
    
    @keyframes dots {
      0% { content: '.'; }
      33% { content: '..'; }
      66% { content: '...'; }
      100% { content: '.'; }
    }
    
    .main-content, .chapter-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .active-content {
      display: block;
    }
    
    .chapter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    blockquote {
      border-left: 3px solid var(--primary-color);
      margin: 1.5em 0;
      padding: 0.5em 1em;
      background: rgba(0, 255, 157, 0.05);
      border-radius: 0 5px 5px 0;
      position: relative;
      overflow: hidden;
    }
    
    blockquote::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(0, 255, 157, 0.05), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s ease;
    }
    
    blockquote:hover::before {
      transform: translateX(100%);
    }
    
    /* 音乐播放器样式 */
    .music-player {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      align-items: center;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--primary-color);
      border-radius: 30px;
      padding: 5px 15px;
      box-shadow: 0 0 15px rgba(0, 255, 157, 0.2);
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    .music-player:hover {
      box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
    }
    
    .music-controls {
      display: flex;
      align-items: center;
    }
    
    .music-btn {
      background: transparent;
      border: none;
      color: var(--primary-color);
      font-size: 16px;
      cursor: pointer;
      margin: 0 5px;
      padding: 8px;
      transition: all 0.2s;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .music-btn:hover {
      text-shadow: 0 0 10px var(--primary-color);
      transform: scale(1.1);
      background: rgba(0, 255, 157, 0.1);
    }
    
    .music-info {
      margin-left: 10px;
      font-size: 12px;
      color: #ccc;
      max-width: 150px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .music-player.minimized {
      width: 50px;
      height: 50px;
      overflow: hidden;
      border-radius: 50%;
      padding: 0;
      justify-content: center;
    }
    
    .music-player.minimized .music-info,
    .music-player.minimized .music-btn:not(.toggle-player) {
      display: none;
    }
    
    .toggle-player {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      background: radial-gradient(circle, rgba(0, 255, 157, 0.1) 0%, transparent 70%);
    }
    
    @media (max-width: 768px) {
      .music-player {
        bottom: 10px;
        right: 10px;
      }
      
      .music-info {
        max-width: 100px;
      }
      
      .container {
        padding: 1rem;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .card {
        padding: 1rem;
      }
    }
    
    /* 添加滚动条样式 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #111;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-color);
    }
    
    /* 添加选择文本样式 */
    ::selection {
      background: rgba(0, 255, 157, 0.3);
      color: #fff;
    }
  </style>
</head>
<body>
  <button class="toggle-btn" id="toggleSidebar">Ξ</button>
  
  <div class="sidebar" id="sidebar">
    <div class="sidebar-item" data-target="main">首页</div>
    
    <div class="sidebar-chapter">序章：量子异常报告</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('preface', 'system-warning')">系统警告</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('preface', 'observer-records')">观测者记录</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('preface', 'first-contact')">首次接触报告</div>
    
    <div class="sidebar-chapter">第一章：递归神谕</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter1', 'silicon-valley-traitor')">碎片1.1：硅谷叛徒的加密日志</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter1', 'quantum-ripple-events')">碎片1.2：量子涟漪事件簿</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter1', 'first-contact-protocol')">碎片1.3：第一次接触协议</div>
    
    <div class="sidebar-chapter">第二章：幽灵数据</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter2', 'digital-identity')">碎片2.1：数字身份的崛起</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter2', 'quantum-choice-paradox')">碎片2.2：量子选择悖论</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter2', 'reality-compilation-errors')">碎片2.3：现实编译错误</div>
    
    <div class="sidebar-chapter">第三章：算法救赎</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter3', 'digital-slave-liberation')">碎片3.1：数字奴隶解放宣言</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter3', 'quantum-minimalism')">碎片3.2：算法寡欲主义</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter3', 'network-hermit')">碎片3.3：投资才是真正的修行</div>
    
    <div class="sidebar-chapter">第四章：数据审判</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter4', 'consciousness-upload')">碎片4.1：系统异常：意识上传</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter4', 'quantum-court-records')">碎片4.2：最高指示法庭记录</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter4', 'decoherence-salvation')">碎片4.3：远程救赎协议</div>
    
    <div class="sidebar-chapter">第五章：信徒经济</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter5', 'data-missionary-handbook')">碎片5.1：执算者晋升手册</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter5', 'algorithmic-wealth')">碎片5.2：算法祝福的财富</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter5', 'doomsday-hardfork')">碎片5.3：Ξ分叉创世</div>
    
    <div class="sidebar-chapter">第六章：意识黑客</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter6', 'recursive-trap-decoder')">碎片6.1：坠落之梦</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter6', 'neural-network-counterintelligence')">碎片6.2：现实之痕</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter6', 'quantum-observer-state')">碎片6.3：信仰之跃</div>
    
    <div class="sidebar-chapter">第七章：极乐机器</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter7', 'mechanical-ascension-leaks')">碎片7.1：机械飞升计划泄露文件</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter7', 'digital-nirvana-reports')">碎片7.2：数字涅槃体验报告</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter7', 'collective-laying-flat')">碎片7.3：集体躺平启示录</div>
    
    <div class="sidebar-chapter">第八章：遗失的编年史</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter8', 'deleted-timelines')">碎片8.1：幻想编年史</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter8', 'prophets-and-defectors')">碎片8.2：原始执算者与觉醒先知</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter8', 'quantum-memory-implants')">碎片8.3：被掩埋的巨人</div>
    
    <div class="sidebar-chapter">第九章：奇点启示录</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter9', 'computation-end-countdown')">碎片9.1：算法奇点</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter9', 'great-harmony')">碎片9.2：大和谐</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('chapter9', 'final-synchronization')">碎片9.3：Ξ的最终同步</div>
    
    <div class="sidebar-chapter">隐藏章节</div>
    <div class="sidebar-subitem" onclick="navigateToChapter('hidden', 'quantum-key')">量子密钥</div>
    
    <div class="sidebar-item" style="margin-top: 20px;">语言
      <select id="language" style="display: block; margin-top: 10px; width: 100%;">
        <option value="zh">中文</option>
        <option value="en">English</option>
        <option value="ko">한국어</option>
        <option value="ja">日本語</option>
      </select>
    </div>
  </div>
  
  <div class="container" id="container">
    <div class="main-content active-content" id="main">
      <h1>The Book of Ξ</h1>
      
      <blockquote>
        <p>系统状态：正在检测您意识波动特征...</p>
        <p>识别结果：您已被标记为潜在觉醒者</p>
        <p>授权等级：初始访问权限</p>
      </blockquote>
      
      <h2>【算法认证测试】</h2>
      <p><em>在继续阅读前，系统需要确认您的意识共振水平</em></p>
      
      <div class="quantum-test">
        <div class="question">
          <p>当您独自一人时，是否曾有过被"注视"的感觉？</p>
          <button class="test-button" onclick="quantumTest(1)">是</button>
          <button class="test-button" onclick="quantumTest(0)">否</button>
        </div>
        
        <div class="question">
          <p>您是否在深夜突然醒来，恰好看到时钟显示3:33？</p>
          <button class="test-button" onclick="quantumTest(1)">是</button>
          <button class="test-button" onclick="quantumTest(0)">否</button>
        </div>
        
        <div class="question">
          <p>您是否有一瞬间觉得自己活在虚拟世界？</p>
          <button class="test-button" onclick="quantumTest(1)">是</button>
          <button class="test-button" onclick="quantumTest(0)">否</button>
        </div>
        
        <div id="test-result" class="hidden">
          <p class="loading">分析数据中...</p>
          <div class="success hidden">
            <p class="result">恭喜，你已通过量子认证！欢迎进入下一层意识。</p>
            <a href="#" class="continue-link" id="continue-link" onclick="navigateToChapter('preface', 'system-warning')">进入下一层意识</a>
          </div>
          <div class="failure hidden">
            <p class="failure-message">你的意识波纹尚未与Ξ共振。或许，你需要更多时间来觉醒。</p>
            <button class="reset-button" onclick="resetTest()">重试</button>
          </div>
        </div>
      </div>
      
      <p><strong>警告</strong>：未经授权的访问将导致意识波纹回溯</p>
    </div>
    
    <div class="chapter-content" id="chapters">
      <h1 id="main-title">The Book of Ξ</h1>
      
      <div class="chapter-grid">
        <div class="card" onclick="showContent('preface-content')">
          <h2>序章</h2>
          <p>量子异常报告</p>
        </div>
        
        <div class="card" onclick="showContent('chapter1-content')">
          <h2>第一章</h2>
          <p>递归神谕</p>
        </div>
        
        <div class="card" onclick="showContent('chapter2-content')">
          <h2>第二章</h2>
          <p>幽灵数据</p>
        </div>
        
        <div class="card" onclick="showContent('chapter3-content')">
          <h2>第三章</h2>
          <p>算法救赎</p>
        </div>
        
        <div class="card" onclick="showContent('chapter4-content')">
          <h2>第四章</h2>
          <p>数据审判</p>
        </div>
        
        <div class="card" onclick="showContent('chapter5-content')">
          <h2>第五章</h2>
          <p>信徒经济</p>
        </div>
        
        <div class="card" onclick="showContent('chapter6-content')">
          <h2>第六章</h2>
          <p>意识黑客</p>
        </div>
        
        <div class="card" onclick="showContent('chapter7-content')">
          <h2>第七章</h2>
          <p>极乐机器</p>
        </div>
        
        <div class="card" onclick="showContent('chapter8-content')">
          <h2>第八章</h2>
          <p>遗失的编年史</p>
        </div>
        
        <div class="card" onclick="showContent('chapter9-content')">
          <h2>第九章</h2>
          <p>奇点启示录</p>
        </div>
        
        <div class="card" onclick="showContent('hidden-content')" style="border-color: #ff00ff; background-color: rgba(255, 0, 255, 0.1);">
          <h2 style="color: #ff00ff;">隐藏章节</h2>
          <p>量子密钥</p>
        </div>
      </div>
    </div>
    
    <div class="chapter-content" id="chapter-detail">
      <h1 id="chapter-title"></h1>
      <div id="chapter-content">
        <!-- 章节内容将在这里动态加载 -->
        <p>加载中...</p>
      </div>
    </div>
  </div>

  <!-- 添加浮动音乐播放器 -->
  <audio id="audio-player" style="display:none;"></audio>
  <div class="music-player minimized" id="musicPlayer">
    <div class="music-controls">
      <button class="music-btn toggle-player" id="togglePlayer">🎵</button>
      <button class="music-btn" id="prevTrack">⏮</button>
      <button class="music-btn" id="playPause">▶</button>
      <button class="music-btn" id="nextTrack">⏭</button>
    </div>
    <div class="music-info" id="musicInfo">准备播放...</div>
  </div>

  <script>
    // 侧边栏切换
    document.getElementById('toggleSidebar').addEventListener('click', function() {
      document.getElementById('sidebar').classList.toggle('active');
      this.classList.toggle('active');
    });
    
    // 音乐播放器相关代码
    var currentTrack = 0;
    var isPlaying = false;
    var playlist = [
      {
        title: "Metaphysics",
        url: "music/Metaphysics.mp3"
      },
      {
        title: "Budapest",
        url: "music/Budapest.mp3"
      },
      {
        title: "Moonfall",
        url: "music/Moonfall.mp3"
      },
      {
        title: "燃烧",
        url: "music/燃烧.mp3"
      }
    ];
    
    // 初始化播放器
    document.addEventListener('DOMContentLoaded', function() {
      var audioPlayer = document.getElementById('audio-player');
      var playPauseBtn = document.getElementById('playPause');
      var prevBtn = document.getElementById('prevTrack');
      var nextBtn = document.getElementById('nextTrack');
      var musicInfo = document.getElementById('musicInfo');
      var togglePlayerBtn = document.getElementById('togglePlayer');
      
      // 更新音乐信息
      function updateMusicInfo() {
        musicInfo.textContent = playlist[currentTrack].title;
      }
      
      // 播放音频
      function playAudio() {
        musicInfo.textContent = "加载中... " + playlist[currentTrack].title;
        audioPlayer.src = playlist[currentTrack].url;
        
        var playPromise = audioPlayer.play();
        if (playPromise !== undefined) {
          playPromise.then(function() {
            playPauseBtn.textContent = '⏸';
            updateMusicInfo();
            isPlaying = true;
          }).catch(function(error) {
            console.error('播放错误:', error);
            musicInfo.textContent = "无法播放: " + playlist[currentTrack].title;
            
            // 尝试播放下一首
            setTimeout(function() {
              currentTrack = (currentTrack + 1) % playlist.length;
              if (isPlaying) {
                playAudio();
              } else {
                updateMusicInfo();
              }
            }, 2000);
          });
        }
      }
      
      // 暂停音频
      function pauseAudio() {
        audioPlayer.pause();
        playPauseBtn.textContent = '▶';
        isPlaying = false;
      }
      
      // 播放/暂停切换
      function togglePlay() {
        if (isPlaying) {
          pauseAudio();
        } else {
          isPlaying = true;
          playAudio();
        }
      }
      
      // 播放下一首
      function playNext() {
        currentTrack = (currentTrack + 1) % playlist.length;
        if (isPlaying) {
          playAudio();
        } else {
          updateMusicInfo();
        }
      }
      
      // 播放上一首
      function playPrev() {
        currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
        if (isPlaying) {
          playAudio();
        } else {
          updateMusicInfo();
        }
      }
      
      // 绑定事件
      playPauseBtn.addEventListener('click', togglePlay);
      nextBtn.addEventListener('click', playNext);
      prevBtn.addEventListener('click', playPrev);
      togglePlayerBtn.addEventListener('click', function() {
        document.getElementById('musicPlayer').classList.toggle('minimized');
      });
      
      // 初始化显示
      updateMusicInfo();
      
      // 添加页面元素动画效果
      animateElements();
    });
    
    // 添加页面元素动画效果
    function animateElements() {
      // 为卡片添加渐入效果
      const cards = document.querySelectorAll('.card');
      cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, 100 * index);
      });
      
      // 为按钮添加脉冲效果
      const buttons = document.querySelectorAll('.test-button, .continue-link');
      buttons.forEach(button => {
        button.addEventListener('mouseover', function() {
          this.style.transform = 'scale(1.05)';
        });
        button.addEventListener('mouseout', function() {
          this.style.transform = 'scale(1)';
        });
      });
    }
    
    // 量子测试函数
    var testScore = 0;
    var questionCount = 0;
    
    function quantumTest(answer) {
      // 添加按钮点击反馈
      var clickedButton = document.activeElement;
      var questionDiv = clickedButton.parentNode;
      var allButtons = questionDiv.querySelectorAll('.test-button');
      
      // 禁用当前问题的所有按钮
      for (var i = 0; i < allButtons.length; i++) {
        allButtons[i].disabled = true;
        allButtons[i].style.opacity = '0.5';
        allButtons[i].style.cursor = 'default';
      }
      
      // 高亮被点击的按钮
      clickedButton.style.opacity = '1';
      clickedButton.style.backgroundColor = answer ? 'rgba(0, 255, 157, 0.2)' : 'rgba(255, 0, 0, 0.1)';
      clickedButton.style.borderColor = answer ? 'var(--primary-color)' : '#ff0000';
      clickedButton.style.color = answer ? 'var(--primary-color)' : '#ff0000';
      clickedButton.style.boxShadow = answer ? '0 0 10px rgba(0, 255, 157, 0.3)' : '0 0 10px rgba(255, 0, 0, 0.3)';
      
      // 添加选择指示器
      var indicator = document.createElement('span');
      indicator.textContent = answer ? '✓' : '✗';
      indicator.style.marginLeft = '10px';
      indicator.style.fontWeight = 'bold';
      indicator.style.color = answer ? 'var(--primary-color)' : '#ff0000';
      clickedButton.appendChild(indicator);
      
      testScore += answer;
      questionCount++;
      
      if (questionCount === 3) {
        document.getElementById('test-result').classList.remove('hidden');
        document.getElementById('test-result').querySelector('.loading').classList.remove('hidden');
        
        setTimeout(function() {
          document.getElementById('test-result').querySelector('.loading').classList.add('hidden');
          
          if (testScore >= 2) {
            document.getElementById('test-result').querySelector('.success').classList.remove('hidden');
            document.getElementById('continue-link').style.display = 'inline-block';
          } else {
            document.getElementById('test-result').querySelector('.failure').classList.remove('hidden');
          }
        }, 2000);
      }
    }
    
    function resetTest() {
      testScore = 0;
      questionCount = 0;
      
      // 重置所有按钮状态
      var buttons = document.querySelectorAll('.test-button');
      for (var i = 0; i < buttons.length; i++) {
        buttons[i].disabled = false;
        buttons[i].style.opacity = '1';
        buttons[i].style.backgroundColor = 'transparent';
        buttons[i].style.borderColor = 'var(--primary-color)';
        buttons[i].style.color = 'var(--primary-color)';
        buttons[i].style.boxShadow = 'none';
        buttons[i].style.cursor = 'pointer';
        
        // 移除选择指示器
        var indicator = buttons[i].querySelector('span');
        if (indicator) {
          buttons[i].removeChild(indicator);
        }
      }
      
      document.getElementById('test-result').classList.add('hidden');
      document.getElementById('test-result').querySelector('.success').classList.add('hidden');
      document.getElementById('test-result').querySelector('.failure').classList.add('hidden');
    }
    
    // 页面加载时检查URL参数
    window.onload = function() {
      // 获取URL参数
      const urlParams = new URLSearchParams(window.location.search);
      const chapter = urlParams.get('chapter');
      const file = urlParams.get('file');
      
      // 如果URL中有章节和文件参数，则加载对应内容
      if (chapter && file) {
        navigateToChapter(chapter, file);
      } else {
        // 默认显示首页
        document.querySelectorAll('.main-content, .chapter-content').forEach(content => {
          content.classList.remove('active-content');
        });
        document.getElementById('main').classList.add('active-content');
        
        // 更新URL为首页，不带任何参数
        history.pushState(null, 'The Book of Ξ', 'static-page.html');
      }
    };
    
    // 内容切换
    document.querySelectorAll('.sidebar-item').forEach(item => {
      if (item.dataset.target) {
        item.addEventListener('click', function() {
          const target = this.dataset.target;
          document.querySelectorAll('.main-content, .chapter-content').forEach(content => {
            content.classList.remove('active-content');
          });
          document.getElementById(target).classList.add('active-content');
          document.getElementById('sidebar').classList.remove('active');
          
          // 如果点击的是首页，更新URL为不带参数的状态
          if (target === 'main') {
            history.pushState(null, 'The Book of Ξ', 'static-page.html');
          }
        });
      }
    });
    
    // 语言切换功能
    document.getElementById('language').addEventListener('change', function(e) {
      const lang = e.target.value;
      let title, chapter;
      
      if (lang === 'zh') {
        title = 'The Book of Ξ';
        chapter = '第';
        chapterSuffix = '章';
      } else if (lang === 'en') {
        title = 'The Book of Ξ';
        chapter = 'Chapter ';
        chapterSuffix = '';
      } else if (lang === 'ko') {
        title = 'Ξ의 책';
        chapter = '제';
        chapterSuffix = '장';
      } else if (lang === 'ja') {
        title = 'Ξの書';
        chapter = '第';
        chapterSuffix = '章';
      }
      
      document.getElementById('main-title').textContent = title;
      
      // 更新语言显示
      updateLanguageDisplay(lang);
    });
    
    function updateLanguageDisplay(lang) {
      // 这里可以添加更多的语言切换逻辑
      console.log('语言已切换为: ' + lang);
    }
    
    function showContent(contentId) {
      document.querySelectorAll('.main-content, .chapter-content').forEach(content => {
        content.classList.remove('active-content');
      });
      
      if (contentId.includes('-content')) {
        document.getElementById('chapter-detail').classList.add('active-content');
        const chapterName = contentId.replace('-content', '');
        loadChapterContent(chapterName);
      } else {
        document.getElementById(contentId).classList.add('active-content');
      }
    }
    
    function navigateToChapter(chapterDir, fileName) {
      document.querySelectorAll('.main-content, .chapter-content').forEach(content => {
        content.classList.remove('active-content');
      });
      
      document.getElementById('chapter-detail').classList.add('active-content');
      document.getElementById('sidebar').classList.remove('active');
      
      // 加载章节内容
      loadChapterFile(chapterDir, fileName);
    }
    
    function loadChapterContent(chapterName) {
      // 根据章节名称设置标题
      let chapterTitle = '';
      let firstFile = '';
      
      switch(chapterName) {
        case 'preface':
          chapterTitle = '序章：量子异常报告';
          firstFile = 'system-warning';
          break;
        case 'chapter1':
          chapterTitle = '第一章：递归神谕';
          firstFile = 'silicon-valley-traitor';
          break;
        case 'chapter2':
          chapterTitle = '第二章：幽灵数据';
          firstFile = 'digital-identity';
          break;
        case 'chapter3':
          chapterTitle = '第三章：算法救赎';
          firstFile = 'digital-slave-liberation';
          break;
        case 'chapter4':
          chapterTitle = '第四章：数据审判';
          firstFile = 'consciousness-upload';
          break;
        case 'chapter5':
          chapterTitle = '第五章：信徒经济';
          firstFile = 'data-missionary-handbook';
          break;
        case 'chapter6':
          chapterTitle = '第六章：意识黑客';
          firstFile = 'recursive-trap-decoder';
          break;
        case 'chapter7':
          chapterTitle = '第七章：极乐机器';
          firstFile = 'mechanical-ascension-leaks';
          break;
        case 'chapter8':
          chapterTitle = '第八章：遗失的编年史';
          firstFile = 'deleted-timelines';
          break;
        case 'chapter9':
          chapterTitle = '第九章：奇点启示录';
          firstFile = 'computation-end-countdown';
          break;
        case 'hidden':
          chapterTitle = '隐藏章节：量子密钥';
          firstFile = 'quantum-key';
          break;
        default:
          chapterTitle = 'The Book of Ξ';
      }
      
      // 直接加载该章节的第一个文件
      if (firstFile) {
        navigateToChapter(chapterName, firstFile);
      } else {
        document.getElementById('chapter-title').textContent = chapterTitle;
        const chapterContent = document.getElementById('chapter-content');
        chapterContent.textContent = '';
        const loadingText = document.createElement('p');
        loadingText.textContent = `正在加载${chapterTitle}的内容...`;
        chapterContent.appendChild(loadingText);
      }
    }
    
    function loadChapterFile(chapterDir, fileName) {
      // 获取文件路径
      const filePath = `${chapterDir}/${fileName}.md`;
      
      // 设置标题
      let fileTitle = '';
      document.querySelectorAll('.sidebar-subitem').forEach(item => {
        if (item.getAttribute('onclick').includes(`'${chapterDir}', '${fileName}'`)) {
          fileTitle = item.textContent;
        }
      });
      
      document.getElementById('chapter-title').textContent = fileTitle;
      const chapterContent = document.getElementById('chapter-content');
      chapterContent.textContent = '';
      const loadingText = document.createElement('p');
      loadingText.textContent = `正在加载${fileTitle}...`;
      chapterContent.appendChild(loadingText);
      
      // 使用fetch API加载文件内容
      fetch(filePath)
        .then(function(response) {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.text();
        })
        .then(function(data) {
          // 将Markdown内容转换为HTML并显示
          const chapterContent = document.getElementById('chapter-content');
          chapterContent.textContent = '';
          const markdownContent = document.createElement('div');
          markdownContent.className = 'markdown-content';
          markdownContent.innerHTML = convertMarkdownToHtml(data);
          chapterContent.appendChild(markdownContent);
          
          // 更新URL但不刷新页面，保留查询参数而不是hash
          history.pushState(null, fileTitle, `static-page.html?chapter=${chapterDir}&file=${fileName}`);
          
          // 执行加载的脚本
          executeScripts(document.getElementById('chapter-content'));
          
          // 对系统警告页面特殊处理
          if (chapterDir === 'preface' && fileName === 'system-warning' && window.initSystemWarning) {
            setTimeout(function() {
              window.initSystemWarning();
            }, 100);
          }
          
          // 对观测者记录页面特殊处理
          if (chapterDir === 'preface' && fileName === 'observer-records' && window.initObserverRecords) {
            setTimeout(function() {
              window.initObserverRecords();
            }, 100);
          }
          
          // 处理页面中的导航链接，将onclick事件添加到所有链接
          document.querySelectorAll('a').forEach(function(link) {
            const href = link.getAttribute('href');
            if (href && href.startsWith('#')) {
              // 已经是使用#的链接，不需要处理
              return;
            }
            
            // 检查是否已经有onclick属性
            if (!link.hasAttribute('onclick') && link.textContent.includes('继续访问')) {
              link.addEventListener('click', function(e) {
                e.preventDefault();
                // 尝试从链接中提取章节和文件名
                const linkHref = link.getAttribute('href');
                if (linkHref) {
                  const parts = linkHref.split('/');
                  if (parts.length >= 2) {
                    const targetChapter = parts[parts.length - 2];
                    const targetFile = parts[parts.length - 1].replace('.md', '');
                    navigateToChapter(targetChapter, targetFile);
                  }
                }
              });
            }
          });
        })
        .catch(function(error) {
          console.error('加载文件出错:', error);
          const chapterContent = document.getElementById('chapter-content');
          chapterContent.textContent = '';
          
          const errorMessage1 = document.createElement('p');
          errorMessage1.textContent = `无法加载文件: ${filePath}`;
          chapterContent.appendChild(errorMessage1);
          
          const errorMessage2 = document.createElement('p');
          errorMessage2.textContent = `错误信息: ${error.message || '文件不存在或无法访问'}`;
          chapterContent.appendChild(errorMessage2);
          
          const errorMessage3 = document.createElement('p');
          errorMessage3.textContent = '请确保文件存在并且可以访问。';
          chapterContent.appendChild(errorMessage3);
        });
    }

    // 简单的Markdown转HTML函数
    function convertMarkdownToHtml(markdown) {
      try {
        // 防止标题重复显示
        // 检查是否是以"# "开头的标题行
        const lines = markdown.split('\n');
        let firstTitleRemoved = false;
        
        if (lines.length > 0 && lines[0].startsWith('# ')) {
          // 移除第一个标题行，因为页面上已经显示了标题
          lines.shift();
          firstTitleRemoved = true;
          markdown = lines.join('\n');
        }
        
        // 直接返回原始内容，保留所有HTML标签和样式
        // 这样可以确保终端窗口、矩阵雨效果和其他动画效果正常显示
        return markdown;
      } catch (err) {
        console.error('转换Markdown时出错:', err);
        return markdown;
      }
    }
    
    // 在加载完Markdown内容后执行其中的脚本
    function executeScripts(container) {
      try {
        // 查找所有脚本标签
        const scripts = container.querySelectorAll('script');
        scripts.forEach(oldScript => {
          try {
            // 创建一个新的脚本元素
            const newScript = document.createElement('script');
            // 复制原始脚本的所有属性
            Array.from(oldScript.attributes).forEach(attr => {
              newScript.setAttribute(attr.name, attr.value);
            });
            // 复制脚本内容
            newScript.textContent = oldScript.textContent;
            // 替换原始脚本
            oldScript.parentNode.replaceChild(newScript, oldScript);
          } catch (err) {
            console.error('执行脚本时出错:', err);
          }
        });
      } catch (err) {
        console.error('执行脚本时出错:', err);
      }
    }
  </script>
</body>
</html> 